<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cronograma Completo – Gnosis Jaraguá do Sul</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&family=Amontillados&display=swap" rel="stylesheet">
  <link rel="icon" href="https://gnosisbrasil.com/wp-content/uploads/2020/07/cropped-logo-sol-7-32x32.webp" type="image/webp">

  <style>
    :root {
      --color-primary: #005bd2;
      --color-dark-bg: #1e3a8a;
      --color-text-light: #ffffff;
      --color-accent: #448ea0;
      --color-success: #198754;
      --font-base: 'Inter', sans-serif;
      --font-heading: 'Poppins', sans-serif;
    }

    body {
      font-family: var(--font-base);
      background-color: var(--color-dark-bg);
      color: var(--color-text-light);
      line-height: 1.6;
    }

    .confirmation-card {
      background-color: #fff;
      border-radius: 1rem;
      color: #212529;
      padding: 2.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
      animation: fadeIn 1s ease-in-out;
      margin: 2rem 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1.title-main {
      font-family: var(--font-heading);
      font-size: 2rem;
      text-transform: uppercase;
      color: var(--color-primary);
      margin-bottom: 0.5rem;
    }

    .astral {
      font-family: 'Amontillados', serif;
      font-weight: normal !important;
      font-size: clamp(2rem, 8vw, 10rem);
    }

    .schedule-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-left: 4px solid var(--color-accent);
      transition: all 0.3s ease;
      display: flex;
      align-items: flex-start;
    }

    .schedule-image {
      width: 125px;
      height: 160px;
      border-radius: 8px;
      object-fit: cover;
      margin-right: 1.5rem;
      flex-shrink: 0;
      border: 2px solid var(--color-primary);
      loading: lazy;
    }

    .btn-material {
      background-color: var(--color-primary);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-decoration: none;
      margin-right: 0.5rem;
    }

    .btn-calendar {
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-decoration: none;
    }

    .floating-panel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      background-color: rgba(9, 52, 86, 0.9);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: slideIn 0.5s ease-out;
    }

    @media (max-width: 768px) {
      .schedule-item { flex-direction: column; }
      .schedule-image {
        width: 100%;
        height: 325px;
        margin-right: 0;
        margin-bottom: 1rem;
      }
    }

    /* Estilos para acessibilidade */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    /* Modo de alto contraste */
    @media (prefers-contrast: high) {
      .confirmation-card {
        border: 2px solid #000;
      }
    }

    /* Redução de movimento */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <!-- Telinha Flutuante -->
  <div id="floatingPanel" class="floating-panel">
    <button class="close-btn" id="closePanel" aria-label="Fechar painel de notificações">
      <i class="fas fa-times"></i>
    </button>
    <h5><i class="fas fa-exclamation-circle"></i> <span data-i18n="notification.title">Não se esqueça!</span></h5>
    <p class="question-text"><span data-i18n="notification.question">Você já realizou sua inscrição no curso?</span></p>
    <div class="answer-options">
      <div class="answer-option" id="optionYes" role="button" tabindex="0" aria-label="Sim, já me inscrevi">Sim</div>
      <div class="answer-option selected" id="optionNo" role="button" tabindex="0" aria-label="Ainda não me inscrevi">Ainda não</div>
    </div>
    <p><span data-i18n="notification.message">Garanta sua vaga no Curso de Autoconhecimento - Gnosis 1ª Câmara</span></p>
    <a href="index.html" class="btn btn-gnosis">
      <i class="fas fa-user-plus me-2"></i> <span data-i18n="notification.button">Fazer Inscrição</span>
    </a>
  </div>

  <!-- Navbar com correção do link -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img src="img/cropped-logo-sol-7.webp" alt="Logo Gnosis" class="me-2" loading="lazy">
        Gnosis Jaraguá do Sul
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Menu de navegação">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://gnosisbrasil.com/quem-somos/">Sobre</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="cronograma.html">Cronograma</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html">Inscrição</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#contact">Contato</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Conteúdo principal -->
  <section class="py-5">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10">
          <div class="confirmation-card">
            <!-- Conteúdo do cartão -->
          </div>

          <!-- Botões de ação -->
          <div class="confirmation-card text-center">
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-4">
              <button class="btn btn-gnosis btn-lg px-4" id="addToCalendar">
                <i class="fas fa-calendar-plus me-2"></i> <span data-i18n="calendar.add">Adicionar ao Google Calendar</span>
              </button>
              <button class="btn btn-whatsapp btn-lg px-4" id="whatsappReminders">
                <i class="fab fa-whatsapp me-2"></i> <span data-i18n="whatsapp.reminders">Lembretes WhatsApp</span>
              </button>
              <button class="btn btn-outline-primary btn-lg px-4" id="downloadPDF">
                <i class="fas fa-file-pdf me-2"></i> <span data-i18n="pdf.download">Baixar PDF</span>
              </button>
            </div>

            <!-- Fórum de discussão -->
            <div class="mt-4">
              <h5 data-i18n="forum.title">Fórum de Discussão</h5>
              <div id="discussionForum" class="text-start">
                <!-- Comentários serão carregados aqui -->
              </div>
              <div class="mt-3">
                <textarea class="form-control" id="newComment" rows="3" placeholder="Compartilhe suas reflexões sobre a aula..." data-i18n-placeholder="forum.placeholder"></textarea>
                <button class="btn btn-primary mt-2" id="submitComment">
                  <i class="fas fa-paper-plane me-2"></i> <span data-i18n="forum.submit">Enviar Comentário</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(function(registration) {
        console.log('ServiceWorker registrado com sucesso');
      }).catch(function(error) {
        console.log('Falha ao registrar ServiceWorker');
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script type="module">
    // Traduções
    const translations = {
      pt: {
        "notification.title": "Não se esqueça!",
        "notification.question": "Você já realizou sua inscrição no curso?",
        "notification.message": "Garanta sua vaga no Curso de Autoconhecimento - Gnosis 1ª Câmara",
        "notification.button": "Fazer Inscrição",
        "calendar.add": "Adicionar ao Google Calendar",
        "whatsapp.reminders": "Lembretes WhatsApp",
        "pdf.download": "Baixar PDF",
        "forum.title": "Fórum de Discussão",
        "forum.placeholder": "Compartilhe suas reflexões sobre a aula...",
        "forum.submit": "Enviar Comentário"
      },
      en: {
        "notification.title": "Don't forget!",
        "notification.question": "Have you already registered for the course?",
        "notification.message": "Secure your spot in the Self-Knowledge Course - Gnosis 1st Chamber",
        "notification.button": "Register Now",
        "calendar.add": "Add to Google Calendar",
        "whatsapp.reminders": "WhatsApp Reminders",
        "pdf.download": "Download PDF",
        "forum.title": "Discussion Forum",
        "forum.placeholder": "Share your reflections on the lesson...",
        "forum.submit": "Submit Comment"
      }
    };

    // Detectar idioma do navegador
    const userLanguage = navigator.language.split('-')[0] || 'pt';
    const currentLanguage = translations[userLanguage] ? userLanguage : 'pt';

    // Aplicar traduções
    function applyTranslations(lang) {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });
      
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
          element.placeholder = translations[lang][key];
        }
      });
    }

    applyTranslations(currentLanguage);

    // Links das aulas com validação
    const lessonLinks = {
      1: "",
      2: "",
      3: "",
      // ... (restante dos links)
    };

    // Sistema de cache para PDFs
    const pdfCache = new Map();

    async function validateAndCachePDF(url, lessonNumber) {
      if (pdfCache.has(lessonNumber)) {
        return pdfCache.get(lessonNumber);
      }

      try {
        const response = await fetch(url, { method: 'HEAD' });
        const isValid = response.ok;
        pdfCache.set(lessonNumber, isValid);
        return isValid;
      } catch {
        pdfCache.set(lessonNumber, false);
        return false;
      }
    }

    // Gerar link do Google Calendar
    function generateGoogleCalendarLink(lesson, date) {
      const baseUrl = 'https://calendar.google.com/calendar/render?action=TEMPLATE';
      const text = `Gnosis - ${lesson}`;
      const dates = date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z/' + 
                    new Date(date.getTime() + 90 * 60000).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
      const details = 'Aula do Curso de Gnosis - 1ª Câmara';
      const location = 'Gnosis Jaraguá do Sul';
      
      return `${baseUrl}&text=${encodeURIComponent(text)}&dates=${dates}&details=${encodeURIComponent(details)}&location=${encodeURIComponent(location)}`;
    }

    // Sistema de lembretes WhatsApp
    function setupWhatsAppReminders() {
      const phoneNumber = '5547999999999'; // Substituir pelo número real
      const message = 'Olá! Gostaria de receber lembretes das aulas do curso de Gnosis.';
      const whatsappLink = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
      
      document.getElementById('whatsappReminders').addEventListener('click', function() {
        window.open(whatsappLink, '_blank');
      });
    }

    // Gerar PDF do cronograma
    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(20);
      doc.text('Cronograma - Curso de Gnosis 1ª Câmara', 20, 30);
      
      doc.setFontSize(12);
      let yPosition = 50;
      
      basicChamber.forEach((topic, index) => {
        const date = scheduleDates[index];
        doc.text(`${index + 1}. ${topic}`, 20, yPosition);
        doc.text(`${formatDateForDisplay(date)}`, 120, yPosition);
        yPosition += 10;
      });
      
      doc.save('cronograma-gnosis.pdf');
    }

    // Sistema de fórum
    let forumComments = JSON.parse(localStorage.getItem('forumComments') || '[]');

    function renderComments() {
      const forumContainer = document.getElementById('discussionForum');
      forumContainer.innerHTML = '';
      
      forumComments.forEach(comment => {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'card mb-2';
        commentDiv.innerHTML = `
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">${comment.author} - ${new Date(comment.timestamp).toLocaleString('pt-BR')}</h6>
            <p class="card-text">${comment.text}</p>
          </div>
        `;
        forumContainer.appendChild(commentDiv);
      });
    }

    document.getElementById('submitComment').addEventListener('click', function() {
      const commentText = document.getElementById('newComment').value.trim();
      if (commentText) {
        const newComment = {
          author: 'Aluno', // Poderia pegar do login do usuário
          text: commentText,
          timestamp: new Date().toISOString()
        };
        
        forumComments.unshift(newComment);
        localStorage.setItem('forumComments', JSON.stringify(forumComments));
        document.getElementById('newComment').value = '';
        renderComments();
      }
    });

    // Event listeners
    document.getElementById('addToCalendar').addEventListener('click', function() {
      // Adicionar todas as aulas ao Google Calendar
      basicChamber.forEach((topic, index) => {
        const link = generateGoogleCalendarLink(topic, scheduleDates[index]);
        window.open(link, '_blank');
      });
    });

    document.getElementById('downloadPDF').addEventListener('click', generatePDF);

    // Inicializar
    setupWhatsAppReminders();
    renderComments();

    // Controle da telinha flutuante com acessibilidade
    const floatingPanel = document.getElementById('floatingPanel');
    const closeButton = document.getElementById('closePanel');
    const optionYes = document.getElementById('optionYes');
    const optionNo = document.getElementById('optionNo');
    
    if (!localStorage.getItem('floatingPanelClosed')) {
      floatingPanel.style.display = 'block';
    } else {
      floatingPanel.style.display = 'none';
    }
    
    closeButton.addEventListener('click', function() {
      floatingPanel.style.display = 'none';
      localStorage.setItem('floatingPanelClosed', 'true');
    });
    
    // Navegação por teclado
    optionYes.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        optionYes.click();
      }
    });
    
    optionNo.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        optionNo.click();
      }
    });

    // Notificações de próxima aula
    function checkNextLesson() {
      const now = new Date();
      const nextLesson = scheduleDates.find(date => date > now);
      
      if (nextLesson) {
        const timeUntilLesson = nextLesson - now;
        const oneDay = 24 * 60 * 60 * 1000;
        
        if (timeUntilLesson <= oneDay && timeUntilLesson > oneDay - 3600000) {
          if ('Notification' in window && Notification.permission === 'granted') {
            new Notification('Próxima aula de Gnosis', {
              body: `A próxima aula será em ${formatDateForDisplay(nextLesson)}`,
              icon: 'img/cropped-logo-sol-7.webp'
            });
          }
        }
      }
    }

    // Solicitar permissão para notificações
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }

    // Verificar próxima aula a cada hora
    setInterval(checkNextLesson, 3600000);

    // Exportar funções para uso global
    window.generateGoogleCalendarLink = generateGoogleCalendarLink;
    window.validateAndCachePDF = validateAndCachePDF;
  </script>

  <!-- Biblioteca para geração de PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>